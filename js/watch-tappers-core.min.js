this.WatchTappers={game:{tapsRaw:[0],tappers:{},watch:{id:"test-watch-1",upgrade:0}},upgrades:{watches:{"test-watch-1":{name:"Test watch 1",priority:0,price:{taps:1,powerOf:0},perTap:{taps:1,powerOf:0},offline:{prod:1,hours:1},faces:["test-watch-face"],upgrades:[]},"test-watch-2":{name:"Test watch 2",priority:0,price:{taps:1,powerOf:1},perTap:{taps:500,powerOf:0},offline:{prod:1,hours:1},faces:["test-watch-face"],upgrades:[{price:{taps:1500,powerOf:0},perTap:{taps:1,powerOf:1}}]}},tappers:{"test-tapper-1":{name:"Test tapper 1",priority:0,price:{taps:1,powerOf:0},perSecond:{taps:1,powerOf:0}},"test-tapper-2":{name:"Test tapper 2",priority:0,price:{taps:1,powerOf:1},perSecond:{taps:1,powerOf:1}},"useless-tapper":{name:"USELESS TAPPER",priority:1,price:{taps:0,powerOf:0},perSecond:{taps:0,powerOf:0}}}},__proto__:{refreshRawTaps:function(){for(var i=0;i<this.game.tapsRaw.length;i++)if(this.game.tapsRaw[i]>=1e3){var thousands=Math.floor(this.game.tapsRaw[i]/1e3);this.game.tapsRaw[i]-=1e3*thousands,i>=this.game.tapsRaw.length-1?this.game.tapsRaw.push(thousands):this.game.tapsRaw[i+1]+=thousands}else this.game.tapsRaw[i]<0&&i+1<this.game.tapsRaw.length&&(this.game.tapsRaw[i+1]-=1,this.game.tapsRaw[i]+=1e3)},addTaps:function(taps,powerOf){if(!(0==taps||0>powerOf)){if(powerOf>=this.game.tapsRaw.length)for(var i=this.game.tapsRaw.length;powerOf>=i;i++)this.game.tapsRaw[i]=0;this.game.tapsRaw[powerOf]+=taps,this.refreshRawTaps()}},tapsLessThan:function(taps,powerOf){this.refreshRawTaps();for(var i=powerOf+1;i<this.game.tapsRaw.length;i++)if(this.game.tapsRaw[i]>0)return!1;return this.game.tapsRaw[powerOf]<taps||powerOf>this.game.tapsRaw.length-1},tapperCount:function(id){return"undefined"==typeof this.game.tappers[id]?0:this.game.tappers[id]},addTapper:function(id,amount){var tappersToAdd="undefined"==typeof amount?1:amount;this.game.tappers[id]=this.tapperCount(id)+tappersToAdd},tapsPerSecond:function(){var generation={};for(var tapperId in this.game.tappers)if(this.game.tappers.hasOwnProperty(tapperId)){if(this.game.tappers[tapperId]<=0)continue;var tapperTPS=this.upgrades.tappers[tapperId].perSecond,taps=tapperTPS.taps*this.game.tappers[tapperId];generation[tapperTPS.powerOf]=generation.hasOwnProperty(tapperTPS.powerOf)?generation[tapperTPS.powerOf]+taps:taps}var objectKeys=Object.keys(generation);if(objectKeys.length<=0)return{taps:0,powerOf:0};var powersToInclude=[Math.max.apply(null,objectKeys)];return objectKeys.indexOf((powersToInclude[0]-1).toString())>=0?(powersToInclude.push(powersToInclude[0]-1),{taps:generation[powersToInclude[1]]+1e3*generation[powersToInclude[0]],powerOf:powersToInclude[1]}):{taps:generation[powersToInclude[0]],powerOf:powersToInclude[0]}},addTapsPerSecond:function(){var TPS=this.tapsPerSecond();this.addTaps(TPS.taps,TPS.powerOf)},startTapperCycle:function(){return window.setInterval(function(t){t.addTapsPerSecond.call(t)},1e3,this)},setWatch:function(watch,upgrade){this.game.watch={id:watch,upgrade:upgrade}},tap:function(multiplier){var x="undefined"==typeof multiplier?1:multiplier,watchUpgrade=this.game.watch.upgrade<=0?this.upgrades.watches[this.game.watch.id]:this.upgrades.watches[this.game.watch.id].upgrades[this.game.watch.upgrade-1],tapsPerTap=watchUpgrade.perTap;this.addTaps(tapsPerTap.taps*x,tapsPerTap.powerOf)},upgradesAvailable:function(type){var upgrades="watch"==type?this.upgrades.watches:this.upgrades.tappers,priorities={};for(var upgrade in upgrades)upgrades.hasOwnProperty(upgrade)&&(priorities.hasOwnProperty(upgrades[upgrade].priority)||(priorities[upgrades[upgrade].priority]=[]),priorities[upgrades[upgrade].priority].push(upgrade));for(var priority in priorities)priorities.hasOwnProperty(priority)&&priorities[priority].sort(function(a,b){var perA="watch"==type?upgrades[a].perTap:upgrades[a].perSecond,perB="watch"==type?upgrades[b].perTap:upgrades[b].perSecond;return perA.powerOf!=perB.powerOf?perA.powerOf<perB.powerOf?-1:1:perA.taps<perB.taps?-1:1});var available=[],p=Object.keys(priorities);p.sort(function(a,b){return b-a});for(var i=0;i<p.length;i++)available=available.concat(priorities[p[i]]);return available},tapperPrice:function(id){var purchasePrice=this.upgrades.tappers[id].price,tapsNeeded=purchasePrice.taps*(1+this.tapperCount(id)/10);return{taps:Math.round(tapsNeeded),powerOf:purchasePrice.powerOf}},purchaseTapper:function(id){var purchasePrice=this.tapperPrice(id);this.tapsLessThan(purchasePrice.taps,purchasePrice.powerOf)||(this.addTaps(-1*purchasePrice.taps,purchasePrice.powerOf),this.addTapper(id,1))},nextWatch:function(){var watchId=this.game.watch.id,watchUpgrade=this.game.watch.upgrade,maxUpgrade=this.upgrades.watches[watchId].upgrades.length;if(maxUpgrade>watchUpgrade)return{status:0,id:watchId,upgrade:watchUpgrade+1};var watches=this.upgradesAvailable("watch"),watchIndex=watches.indexOf(watchId);return 0>watchIndex?{status:3}:watchIndex+1>=watches.length?{status:2}:{status:1,id:watches[watchIndex+1],upgrade:0}},upgradeWatch:function(){var nextUpgrade=this.nextWatch();if(nextUpgrade.status<0||nextUpgrade.status>1)return!1;var watchObject=this.upgrades.watches[nextUpgrade.id];0==nextUpgrade.status&&(watchObject=watchObject.upgrades[nextUpgrade.upgrade-1]);var price=watchObject.price;return this.tapsLessThan(price.taps,price.powerOf)||(this.addTaps(-1*price.taps,price.powerOf),this.setWatch(nextUpgrade.id,nextUpgrade.upgrade)),!this.tapsLessThan(price.taps,price.powerOf)}}};